import{a as c,j as e}from"./react-core-0npe00lJ.js";import{F as I,E as b,X as Q,v as B,N as K,ag as G,V as J}from"./react-icons-B--SyvS1.js";import{u as R}from"./roleApi-B0i8R29N.js";import{b as X,a as S,u as k}from"./react-query-BvwtvcJK.js";import{s as C,f as U,q as E,B as f}from"./index-HjQGXCX9.js";import{C as H}from"./Chips-3gluTL3o.js";import{I as N,S as D}from"./InputFields-CMQHEwPH.js";import"./vendor-CGKUqG9W.js";import"./react-dom-CdyVvfHO.js";import"./ui-libs-CuSWTeap.js";import"./react-router-lgh_Y1WM.js";import"./zustand-Ccm-5Iud.js";import"./axios-B9ygI19o.js";async function O(t={}){const s=new URLSearchParams;t.page!==void 0&&s.append("page",t.page.toString()),t.limit!==void 0&&s.append("limit",t.limit.toString()),t.sort&&s.append("sort",t.sort),t.order&&s.append("order",t.order),t.search&&s.append("search",t.search),t.isVerified!==void 0&&s.append("isVerified",t.isVerified.toString()),t.isActive!==void 0&&s.append("isActive",t.isActive.toString());const o=s.toString(),a=`/users${o?`?${o}`:""}`;return(await E.get(a)).data}const W=(t={})=>X({queryKey:["users",t],queryFn:()=>O(t)});async function Y(t){return(await E.post("/users/invitation",t)).data}const Z=()=>{const t=S();return k({mutationFn:s=>Y(s),onSuccess:s=>{U(s?.message||"User invitation sent successfully"),t.invalidateQueries({queryKey:["users"]})},onError:s=>{console.error("Invite User Failed:",s);const a=s.response?.data?.message||"Failed to send invitation";C(a)}})};async function _(t){const{userId:s,...o}=t;return(await E.patch(`/users/${s}`,o)).data}const ee=()=>{const t=S();return k({mutationFn:s=>_(s),onSuccess:s=>{U(s?.message||"User updated successfully"),t.invalidateQueries({queryKey:["users"]})},onError:s=>{console.error("Update User Failed:",s);const a=s.response?.data?.message||"Failed to update user";C(a)}})};async function se(t){return(await E.post(`/users/invitations/${t}/resend`)).data}const te=()=>{const t=S();return k({mutationFn:s=>se(s),onSuccess:s=>{U(s?.message||"Invitation resent successfully"),t.invalidateQueries({queryKey:["users"]})},onError:s=>{console.error("Resend Invitation Failed:",s);const a=s.response?.data?.message||"Failed to resend invitation";C(a)}})},ae=({isOpen:t,onClose:s,user:o})=>{const[a,m]=c.useState({name:"",email:"",phone:"",roleId:"",isActive:!0}),[l,x]=c.useState({}),{data:g}=R(),d=g?.data?.items||[],{mutateAsync:v,isPending:p}=ee();c.useEffect(()=>{o&&m({name:o.name||"",email:o.email||"",phone:"",roleId:o.role?.id||"",isActive:!0})},[o]),c.useEffect(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[t]),c.useEffect(()=>{const i=h=>{h.key==="Escape"&&t&&!p&&s()};return t&&document.addEventListener("keydown",i),()=>{document.removeEventListener("keydown",i)}},[t,s,p]);const w=i=>{i.target===i.currentTarget&&!p&&s()},n=()=>{const i={};return a.name.trim()||(i.name="Name is required"),a.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.email)||(i.email="Please enter a valid email address"):i.email="Email is required",a.roleId||(i.roleId="Please select a role"),x(i),Object.keys(i).length===0},u=async i=>{if(i.preventDefault(),!(!n()||!o))try{await v({userId:o.id,name:a.name,email:a.email,roleId:a.roleId,phone:a.phone||void 0,isActive:a.isActive}),x({}),s()}catch(h){console.error("Update user error:",h)}};return!t||!o?null:e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm px-4",onClick:w,children:e.jsxs("div",{className:"w-full max-w-2xl rounded-2xl bg-white p-6 shadow-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-primary",children:"Edit User"}),e.jsx("button",{onClick:s,disabled:p,className:"text-primary-50 hover:text-primary transition-colors disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Close",children:e.jsx(I,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:u,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-primary mb-4",children:"User Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(N,{id:"edit-user-name",label:"Name",value:a.name,onChange:i=>{m({...a,name:i.target.value}),l.name&&x(h=>({...h,name:""}))},required:!0,placeholder:"Enter full name"}),l.name&&e.jsxs("p",{className:"text-red-500 text-xs mt-1 flex items-center gap-1",children:[e.jsx(b,{className:"w-3 h-3"}),l.name]})]}),e.jsxs("div",{children:[e.jsx(N,{id:"edit-user-email",label:"Email",type:"email",value:a.email,onChange:i=>{m({...a,email:i.target.value}),l.email&&x(h=>({...h,email:""}))},required:!0,placeholder:"user@example.com"}),l.email&&e.jsxs("p",{className:"text-red-500 text-xs mt-1 flex items-center gap-1",children:[e.jsx(b,{className:"w-3 h-3"}),l.email]})]}),e.jsx("div",{children:e.jsx(N,{id:"edit-user-phone",label:"Phone",type:"tel",value:a.phone,onChange:i=>{m({...a,phone:i.target.value})},placeholder:"(123) 456-7890"})}),e.jsxs("div",{children:[e.jsx(D,{id:"edit-user-role",label:"Role",value:a.roleId,onChange:i=>{m({...a,roleId:i.target.value}),l.roleId&&x(h=>({...h,roleId:""}))},required:!0,options:d.map(i=>({value:i.id,label:i.displayName}))}),l.roleId&&e.jsxs("p",{className:"text-red-500 text-xs mt-1 flex items-center gap-1",children:[e.jsx(b,{className:"w-3 h-3"}),l.roleId]})]})]})]}),e.jsx("div",{className:"border-t border-primary-10 pt-4",children:e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:a.isActive,onChange:i=>m({...a,isActive:i.target.checked}),className:"w-4 h-4 text-primary border-primary-10 rounded focus:ring-primary"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-primary",children:"Active account"}),e.jsx("p",{className:"text-xs text-primary-50",children:"User can access the system when active"})]})]})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-primary-10",children:[e.jsx(f,{type:"button",variant:"outline",onClick:s,disabled:p,children:"Cancel"}),e.jsx(f,{type:"submit",variant:"primary",loading:p,disabled:p,children:"Save Changes"})]})]})]})})},re=({isOpen:t,onClose:s,roles:o=[]})=>{const[a,m]=c.useState({name:"",email:"",roleId:""}),[l,x]=c.useState({}),{mutateAsync:g,isPending:d}=Z();c.useEffect(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[t]),c.useEffect(()=>{const n=u=>{u.key==="Escape"&&t&&!d&&s()};return t&&document.addEventListener("keydown",n),()=>{document.removeEventListener("keydown",n)}},[t,s,d]);const v=n=>{n.target===n.currentTarget&&!d&&s()},p=()=>{const n={};return a.name.trim()?a.name.trim().length<2&&(n.name="Name must be at least 2 characters"):n.name="Name is required",a.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.email)||(n.email="Please enter a valid email address"):n.email="Email is required",a.roleId||(n.roleId="Please select a role"),x(n),Object.keys(n).length===0},w=async n=>{if(n.preventDefault(),!!p())try{await g({name:a.name,email:a.email,roleId:a.roleId}),m({name:"",email:"",roleId:""}),x({}),s()}catch(u){console.error("Invite user error:",u)}};return t?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm px-4",onClick:v,children:e.jsxs("div",{className:"w-full max-w-2xl rounded-2xl bg-white p-6 shadow-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-primary",children:"Add user"}),e.jsx("button",{onClick:s,disabled:d,className:"text-primary-50 hover:text-primary transition-colors disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Close",children:e.jsx(I,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:w,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-primary mb-4",children:"User Information"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(N,{id:"user-name",label:"Full Name",type:"text",value:a.name,onChange:n=>{m({...a,name:n.target.value}),l.name&&x(u=>({...u,name:""}))},required:!0,placeholder:"John Doe"}),l.name&&e.jsxs("p",{className:"text-red-500 text-xs mt-1 flex items-center gap-1",children:[e.jsx(b,{className:"w-3 h-3"}),l.name]})]}),e.jsxs("div",{children:[e.jsx(N,{id:"user-email",label:"Email",type:"email",value:a.email,onChange:n=>{m({...a,email:n.target.value}),l.email&&x(u=>({...u,email:""}))},required:!0,placeholder:"user@example.com"}),l.email&&e.jsxs("p",{className:"text-red-500 text-xs mt-1 flex items-center gap-1",children:[e.jsx(b,{className:"w-3 h-3"}),l.email]})]})]})]}),e.jsxs("div",{children:[e.jsx(D,{id:"user-role",label:"Select a role",value:a.roleId,onChange:n=>{m({...a,roleId:n.target.value}),l.roleId&&x(u=>({...u,roleId:""}))},required:!0,options:o.map(n=>({value:n.id,label:n.displayName}))}),l.roleId&&e.jsxs("p",{className:"text-red-500 text-xs mt-1 flex items-center gap-1",children:[e.jsx(b,{className:"w-3 h-3"}),l.roleId]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-primary-10",children:[e.jsx(f,{type:"button",variant:"outline",onClick:s,disabled:d,children:"Cancel"}),e.jsx(f,{type:"submit",variant:"primary",loading:d,disabled:d,children:"Send invite"})]})]})]})}):null},ve=()=>{const[t,s]=c.useState(""),[o,a]=c.useState(!1),[m,l]=c.useState(!1),[x,g]=c.useState(null),[d,v]=c.useState({page:1,limit:20,sort:"createdAt",order:"asc"}),{data:p,isLoading:w,isError:n}=W(d),{data:u}=R(),i=u?.data?.items||[],{mutateAsync:h,isPending:F}=te();c.useEffect(()=>{d.search!==void 0&&s(d.search)},[d.search]);const V=r=>{g(r),l(!0)},M=()=>{l(!1),g(null)},z=r=>{r.preventDefault(),v(j=>({...j,search:t.trim()||void 0,page:1}))},L=()=>{s(""),v(r=>({...r,search:void 0,page:1}))},T=async r=>{try{await h(r)}catch(j){console.error("Resend invitation error:",j)}},A=r=>{v(j=>({...j,page:r}))},q=(r,j)=>{v($=>({...$,[r]:j,page:1}))},P=p?.data?.items||[],y=p?.data?.pagination;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-primary",children:"Users Management"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-primary-50",children:[e.jsx(Q,{className:"w-4 h-4"}),e.jsxs("span",{children:[y?.total||0," user",y?.total!==1?"s":""]})]}),e.jsxs(f,{variant:"primary",size:"sm",onClick:()=>a(!0),children:[e.jsx(B,{className:"mr-2"}),"Invite User"]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("form",{onSubmit:z,className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(N,{id:"user-search",placeholder:"Search users by name or email...",value:t,onChange:r=>s(r.target.value),icon:e.jsx(K,{className:"w-4 h-4"})}),t&&e.jsx("button",{type:"button",onClick:L,className:"absolute right-12 top-1/2 transform -translate-y-1/2 text-primary-50 hover:text-primary transition-colors","aria-label":"Clear search",children:e.jsx(I,{className:"w-4 h-4"})})]}),e.jsx(f,{type:"submit",variant:"primary",children:"Search"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:d.isVerified===!0,onChange:r=>q("isVerified",r.target.checked?!0:void 0),className:"w-4 h-4 text-primary border-primary-10 rounded focus:ring-primary"}),e.jsx("span",{className:"text-sm text-primary",children:"Verified Only"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:d.isActive===!0,onChange:r=>q("isActive",r.target.checked?!0:void 0),className:"w-4 h-4 text-primary border-primary-10 rounded focus:ring-primary"}),e.jsx("span",{className:"text-sm text-primary",children:"Active Only"})]})]})]}),w?e.jsx("div",{className:"text-center py-8 text-primary-50",children:"Loading users..."}):n?e.jsx("div",{className:"text-center py-8 text-red-500",children:"Failed to load users. Please try again."}):P.length===0?e.jsx("div",{className:"text-center py-8 text-primary-50",children:"No users found"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-primary-10",children:[e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-primary",children:"Name"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-primary",children:"Email"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-primary",children:"Role"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-semibold text-primary",children:"Status"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-semibold text-primary",children:"Actions"})]})}),e.jsx("tbody",{children:P.map(r=>e.jsxs("tr",{className:"border-b border-primary-10 hover:bg-primary-5 transition-colors",children:[e.jsx("td",{className:"py-3 px-4 text-sm text-primary",children:r.name}),e.jsx("td",{className:"py-3 px-4 text-sm text-primary-75",children:r.email}),e.jsx("td",{className:"py-3 px-4 text-sm text-primary-75",children:r.role?.displayName||r.role?.name||r.roles?.[0]?.displayName||r.roles?.[0]?.name||"N/A"}),e.jsx("td",{className:"py-3 px-4 text-sm",children:e.jsx(H,{label:r.isVerified?"Verified":"Unverified",variant:r.isVerified?"success":"danger"})}),e.jsx("td",{className:"py-3 px-4 text-sm text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[!r.isVerified&&e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>T(r.id),loading:F,disabled:F,title:"Resend invitation email",children:[e.jsx(G,{className:"mr-1"}),"Resend"]}),e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>V(r),children:[e.jsx(J,{className:"mr-1"}),"Edit"]})]})})]},r.id))})]})}),y&&y.totalPages>1&&e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-primary-10",children:[e.jsxs("div",{className:"text-sm text-primary-50",children:["Showing page ",y.page," of"," ",y.totalPages," (",y.total," ","total users)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{variant:"outline",size:"sm",onClick:()=>A(y.page-1),disabled:!y.hasPreviousPage,children:"Previous"}),e.jsx(f,{variant:"outline",size:"sm",onClick:()=>A(y.page+1),disabled:!y.hasNextPage,children:"Next"})]})]})]}),e.jsx(re,{isOpen:o,onClose:()=>a(!1),roles:i}),x&&e.jsx(ae,{isOpen:m,onClose:M,user:x})]})};export{ve as default};
