import{a as i,j as e}from"./react-core-0npe00lJ.js";import{s as v,f as D,q as O,v as oe,B as p,i as le,w as Z,x as _,j as de,y as ce,z as ue,D as me}from"./index-HjQGXCX9.js";import{a as pe,b as ye,c as xe,d as be}from"./mfaApi-C0--BS-Z.js";import{b as re,u as M,a as I}from"./react-query-BvwtvcJK.js";import{C as U}from"./ConfirmationDialog-CVwwzHxz.js";import{F as se,v as he,z as ee,q as fe,V as ge,W as je,ad as ve,ae as we,D as te,af as ae,Q as Ne}from"./react-icons-B--SyvS1.js";import{I as L}from"./InputFields-CMQHEwPH.js";import"./react-dom-CdyVvfHO.js";import"./vendor-CGKUqG9W.js";import"./ui-libs-CuSWTeap.js";import"./react-router-lgh_Y1WM.js";import"./zustand-Ccm-5Iud.js";import"./axios-B9ygI19o.js";async function ke(){return(await O.post("/passkey/register/options")).data}async function Ce(t){return(await O.post("/passkey/register/verify",t)).data}async function Pe(){return(await O.get("/passkey")).data}async function Se(){return(await O.get("/passkey/stats")).data}async function Te(t){return(await O.delete(`/passkey/${t}`)).data}async function Ee(t){return(await O.patch(`/passkey/${t.passkeyId}/rename`,{name:t.name})).data}async function ne(t){return(await O.patch(`/passkey/${t}/toggle`)).data}async function Ae(t){return ne(t)}async function De(t){return ne(t)}const Fe=()=>M({mutationFn:ke,onError:t=>{console.error("Failed to get passkey registration options:",t);const l=t.response?.data?.message||"Failed to initialize passkey registration";v(l)}}),Oe=()=>{const t=I();return M({mutationFn:s=>Ce(s),onSuccess:s=>{D(s?.message||"Passkey registered successfully!"),t.invalidateQueries({queryKey:["passkeys"]}),t.invalidateQueries({queryKey:["passkey-stats"]})},onError:s=>{console.error("Failed to register passkey:",s);const r=s.response?.data?.message||"Failed to register passkey. Please try again.";v(r)}})},Re=()=>re({queryKey:["passkeys"],queryFn:Pe}),qe=()=>re({queryKey:["passkey-stats"],queryFn:Se}),Le=()=>{const t=I();return M({mutationFn:s=>Te(s),onSuccess:s=>{D(s?.message||"Passkey deleted successfully"),t.invalidateQueries({queryKey:["passkeys"]}),t.invalidateQueries({queryKey:["passkey-stats"]})},onError:s=>{console.error("Failed to delete passkey:",s);const r=s.response?.data?.message||"Failed to delete passkey";v(r)}})},Me=()=>{const t=I();return M({mutationFn:s=>Ee(s),onSuccess:s=>{D(s?.message||"Passkey renamed successfully"),t.invalidateQueries({queryKey:["passkeys"]})},onError:s=>{console.error("Failed to rename passkey:",s);const r=s.response?.data?.message||"Failed to rename passkey";v(r)}})},Ke=()=>{const t=I();return M({mutationFn:s=>Ae(s),onSuccess:s=>{D(s?.message||"Passkey enabled successfully"),t.invalidateQueries({queryKey:["passkeys"]}),t.invalidateQueries({queryKey:["passkey-stats"]})},onError:s=>{console.error("Failed to enable passkey:",s);const r=s.response?.data?.message||"Failed to enable passkey";v(r)}})},Ve=()=>{const t=I();return M({mutationFn:s=>De(s),onSuccess:s=>{D(s?.message||"Passkey disabled successfully"),t.invalidateQueries({queryKey:["passkeys"]}),t.invalidateQueries({queryKey:["passkey-stats"]})},onError:s=>{console.error("Failed to disable passkey:",s);const r=s.response?.data?.message||"Failed to disable passkey";v(r)}})},Be=({isOpen:t,onClose:s})=>{const[l,r]=i.useState(""),[m,n]=i.useState(""),[d,c]=i.useState(""),{mutateAsync:g,isPending:j}=oe(),[w,h]=i.useState("");i.useEffect(()=>(t?(r(""),n(""),c(""),h(""),document.body.style.overflow="hidden"):document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[t]);const S=async x=>{if(x.preventDefault(),h(""),!l||!m||!d){h("All fields are required");return}if(m!==d){h("Passwords do not match");return}if(m.length<8){h("Password must be at least 8 characters long");return}try{console.log("submitting password change ..."),await g({currentPassword:l,newPassword:m}),s()}catch(u){const T=u&&typeof u=="object"&&"response"in u&&u.response&&typeof u.response=="object"&&"data"in u.response&&u.response.data&&typeof u.response.data=="object"&&"message"in u.response.data&&typeof u.response.data.message=="string"?u.response.data.message:"Failed to update password";h(T)}};return t?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm px-4",children:e.jsxs("div",{className:"w-full max-w-md rounded-2xl bg-white p-6 shadow-2xl animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-primary",children:"Change Password"}),e.jsx("button",{onClick:s,className:"text-primary-50 hover:text-primary transition-colors",children:e.jsx(se,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsx(L,{id:"current-password",label:"Current Password",type:"password",placeholder:"Enter current password",value:l,onChange:x=>r(x.target.value),autoComplete:"current-password",required:!0}),e.jsx(L,{id:"new-password",label:"New Password",type:"password",placeholder:"Enter new password",value:m,onChange:x=>n(x.target.value),autoComplete:"new-password",required:!0}),e.jsx(L,{id:"confirm-password",label:"Confirm New Password",type:"password",placeholder:"Re-enter new password",value:d,onChange:x=>c(x.target.value),autoComplete:"new-password",required:!0}),w&&e.jsx("div",{className:"p-3 text-sm text-red-600 bg-red-50 rounded-lg border border-red-200",children:w}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(p,{type:"button",variant:"outline",onClick:s,disabled:j,children:"Cancel"}),e.jsx(p,{type:"submit",variant:"primary",loading:j,disabled:j,children:"Update Password"})]})]})]})}):null},Qe=({isOpen:t,onClose:s})=>{const[l,r]=i.useState("list"),[m,n]=i.useState(""),[d,c]=i.useState(null),[g,j]=i.useState(!1),[w,h]=i.useState(!0),{data:S,isLoading:x}=Re(),{mutateAsync:u}=Fe(),{mutateAsync:T}=Oe(),{mutate:b,isPending:C}=Le(),{mutate:K,isPending:N}=Me(),{mutate:V,isPending:R}=Ke(),{mutate:B,isPending:o}=Ve(),f=S?.data?.passkeys||[];i.useEffect(()=>{h(le())},[]),i.useEffect(()=>{t||(r("list"),n(""),c(null))},[t]);const A=()=>{g||C||N||s()},k=()=>{r("register"),n("")},P=async()=>{if(!w){v("WebAuthn is not supported in this browser. Please use a modern browser.");return}if(!m.trim()){v("Please enter a friendly name for your passkey");return}j(!0);try{const y=(await u()).data.options,X={challenge:Z(y.challenge),rp:{name:y.rp.name,id:y.rp.id},user:{id:Z(y.user.id),name:y.user.name,displayName:y.user.displayName},pubKeyCredParams:y.pubKeyCredParams.map(q=>({alg:q.alg,type:q.type})),timeout:y.timeout,attestation:y.attestation,excludeCredentials:y.excludeCredentials.map(q=>({id:Z(q.id),type:q.type,transports:q.transports})),authenticatorSelection:{userVerification:y.authenticatorSelection.userVerification,residentKey:y.authenticatorSelection.residentKey,requireResidentKey:y.authenticatorSelection.requireResidentKey},extensions:y.extensions},E=await navigator.credentials.create({publicKey:X});if(!E)throw new Error("No credential returned from authenticator");const F=E.response;let Q;"getTransports"in F&&typeof F.getTransports=="function"&&(Q=F.getTransports());const ie={id:E.id,rawId:_(E.rawId),response:{attestationObject:_(F.attestationObject),clientDataJSON:_(F.clientDataJSON),transports:Q},type:E.type,clientExtensionResults:E.getClientExtensionResults(),authenticatorAttachment:E.authenticatorAttachment||void 0};await T({name:m.trim(),credential:ie}),r("list"),n("")}catch(a){console.error("Passkey registration failed:",a),a instanceof DOMException&&(a.name==="NotAllowedError"?v("Registration was cancelled or not allowed"):a.name==="SecurityError"?v("Security error during registration. Please try again."):a.name==="AbortError"?v("Registration was aborted"):a.name==="InvalidStateError"&&v("This authenticator is already registered. Please use a different one."))}finally{j(!1)}},$=a=>{c(a),n(a.name),r("rename")},Y=()=>{if(d){if(!m.trim()){v("Please enter a friendly name");return}K({passkeyId:d.id,name:m.trim()},{onSuccess:()=>{r("list"),n(""),c(null)}})}},W=a=>{c(a),r("confirm-delete")},G=()=>{d&&b(d.id,{onSuccess:()=>{r("list"),c(null)}})},J=a=>{a.isActive?(c(a),r("confirm-disable")):V(a.id)},H=()=>{d&&B(d.id,{onSuccess:()=>{r("list"),c(null)}})},z=a=>a?new Date(a).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Never";return t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/15 bg-opacity-50 p-4",onClick:a=>a.target===a.currentTarget&&!g&&!C&&!N&&A(),children:e.jsxs("div",{className:"w-full max-w-2xl rounded-2xl bg-white p-6 shadow-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-xl font-semibold text-primary",children:[l==="list"&&"Passkey Management",l==="register"&&"Register New Passkey",l==="rename"&&"Rename Passkey"]}),e.jsx("button",{onClick:A,disabled:g||C||N,className:"text-primary-50 hover:text-primary transition-colors disabled:opacity-50",children:e.jsx(se,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-6",children:[!w&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4",children:e.jsx("p",{className:"text-sm text-red-800",children:"Your browser doesn't support passkeys. Please use a modern browser like Chrome, Edge, Safari, or Firefox."})}),l==="list"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:e.jsx("p",{className:"text-sm text-blue-800",children:"Passkeys are a more secure and convenient way to sign in. Use your fingerprint, face, or device PIN instead of a password."})}),e.jsxs(p,{variant:"primary",onClick:k,disabled:!w,className:"w-full",children:[e.jsx(he,{className:"w-4 h-4"}),"Add New Passkey"]}),x?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"text-sm text-primary-50 mt-3",children:"Loading passkeys..."})]}):f.length===0?e.jsxs("div",{className:"bg-gray-50 border border-primary-10 rounded-xl p-8 text-center",children:[e.jsx(ee,{className:"w-12 h-12 text-primary-20 mx-auto mb-3"}),e.jsx("p",{className:"text-sm font-medium text-primary mb-1",children:"No passkeys registered yet"}),e.jsx("p",{className:"text-xs text-primary-50",children:"Add a passkey to enable passwordless authentication"})]}):e.jsx("div",{className:"space-y-3",children:f.map(a=>e.jsx("div",{className:`border rounded-xl p-4 transition-colors ${a.isActive?"border-primary-10 bg-white":"border-gray-200 bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center shrink-0 ${a.isActive?"bg-primary-10":"bg-gray-200"}`,children:e.jsx(ee,{className:`w-5 h-5 ${a.isActive?"text-primary":"text-gray-400"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium text-primary truncate",children:a.name}),a.isActive&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-green-100 text-green-700 text-xs font-medium",children:[e.jsx(fe,{className:"w-3 h-3"}),"Active"]}),!a.isActive&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full bg-gray-200 text-gray-600 text-xs font-medium",children:"Disabled"})]}),e.jsxs("p",{className:"text-xs text-primary-50 mt-1",children:["Created:"," ",z(a.createdAt)]}),e.jsxs("p",{className:"text-xs text-primary-50",children:["Last used:"," ",z(a.lastUsedAt)]}),e.jsxs("p",{className:"text-xs text-primary-40",children:["Type:"," ",a.credentialType==="platform"?"Device":"Security Key",a.backupEligible&&" • Backup enabled"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsx("button",{onClick:()=>$(a),className:"p-2 text-primary-50 hover:text-primary hover:bg-primary-5 rounded-lg transition-colors",title:"Rename",children:e.jsx(ge,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>J(a),className:`px-3 py-1 rounded-lg text-xs font-medium transition-colors ${a.isActive?"bg-yellow-100 text-yellow-700 hover:bg-yellow-200":"bg-green-100 text-green-700 hover:bg-green-200"}`,disabled:R||o,children:a.isActive?"Disable":"Enable"}),e.jsx("button",{onClick:()=>W(a),className:"p-2 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-lg transition-colors",title:"Delete",children:e.jsx(je,{className:"w-4 h-4"})})]})]})},a.id))})]}),l==="register"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:[e.jsxs("h4",{className:"font-semibold text-blue-900 mb-2 flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4"}),"Biometric Authentication"]}),e.jsx("p",{className:"text-sm text-blue-800",children:"You'll be prompted to use your device's biometric authentication (fingerprint, face recognition) or security key."})]}),e.jsxs("div",{children:[e.jsx(L,{label:"Passkey Name",placeholder:"e.g., My iPhone, Touch ID, Work Laptop",value:m,onChange:a=>n(a.target.value),disabled:g,required:!0}),e.jsx("p",{className:"text-xs text-primary-50 mt-2",children:"Give this passkey a name to help you identify it later"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-primary-10",children:[e.jsx(p,{type:"button",variant:"outline",onClick:()=>r("list"),disabled:g,children:"Cancel"}),e.jsx(p,{type:"button",variant:"primary",onClick:P,loading:g,disabled:g,children:"Register Passkey"})]})]}),l==="rename"&&d&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gray-50 border border-primary-10 rounded-xl p-4",children:e.jsx("p",{className:"text-sm text-primary-75",children:"Update the name of this passkey to help you identify it more easily."})}),e.jsx(L,{label:"Passkey Name",placeholder:"e.g., My iPhone, Touch ID, Work Laptop",value:m,onChange:a=>n(a.target.value),disabled:N,required:!0}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-primary-10",children:[e.jsx(p,{type:"button",variant:"outline",onClick:()=>r("list"),disabled:N,children:"Cancel"}),e.jsx(p,{type:"button",variant:"primary",onClick:Y,loading:N,disabled:N,children:"Save Changes"})]})]})]})]})}),e.jsx(U,{isOpen:l==="confirm-delete"&&!!d,onClose:()=>{r("list"),c(null)},onConfirm:G,title:"Delete Passkey",message:`Are you sure you want to delete "${d?.name}"? This action cannot be undone.`,confirmText:"Delete Passkey",cancelText:"Cancel",confirmVariant:"danger",loading:C}),e.jsx(U,{isOpen:l==="confirm-disable"&&!!d,onClose:()=>{r("list"),c(null)},onConfirm:H,title:"Disable Passkey",message:`Are you sure you want to disable "${d?.name}"? You can re-enable it later.`,confirmText:"Disable Passkey",cancelText:"Cancel",confirmVariant:"danger",loading:o})]}):null},Ie=({isOpen:t,onClose:s,onSuccess:l})=>{const[r,m]=i.useState("setup"),[n,d]=i.useState(null),[c,g]=i.useState(""),[j,w]=i.useState(!1),[h,S]=i.useState(!1),{mutateAsync:x,isPending:u}=pe(),{mutateAsync:T,isPending:b}=ye();i.useEffect(()=>(t?(document.body.style.overflow="hidden",C()):(document.body.style.overflow="unset",m("setup"),d(null),g(""),w(!1),S(!1)),()=>{document.body.style.overflow="unset"}),[t]),i.useEffect(()=>{const o=f=>{f.key==="Escape"&&t&&!u&&!b&&s()};return t&&document.addEventListener("keydown",o),()=>{document.removeEventListener("keydown",o)}},[t,s,u,b]);const C=async()=>{try{const o=await x();d(o.data)}catch(o){console.error("Failed to setup TOTP:",o),s()}},K=()=>{n?.secret&&(navigator.clipboard.writeText(n.secret),w(!0),D("Secret copied to clipboard"),setTimeout(()=>w(!1),3e3))},N=()=>{if(n?.backupCodes){const o=n.backupCodes.join(`
`);navigator.clipboard.writeText(o),S(!0),D("Backup codes copied to clipboard"),setTimeout(()=>S(!1),3e3)}},V=()=>{if(n?.backupCodes){const o=n.backupCodes.join(`
`),f=new Blob([o],{type:"text/plain"}),A=URL.createObjectURL(f),k=document.createElement("a");k.href=A,k.download="backup-codes.txt",document.body.appendChild(k),k.click(),document.body.removeChild(k),URL.revokeObjectURL(A),D("Backup codes downloaded")}},R=async o=>{o.preventDefault();try{await T(c),l?.(),s()}catch(f){console.error("Verification failed:",f)}},B=()=>{m("verify")};return!t||!n?null:e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm px-4",onClick:o=>o.target===o.currentTarget&&!u&&!b&&s(),children:e.jsxs("div",{className:"w-full max-w-2xl rounded-2xl bg-white p-6 shadow-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-primary",children:r==="setup"?"Setup Authenticator App":"Verify Setup"}),e.jsx("button",{onClick:s,disabled:u||b,className:"text-primary-50 hover:text-primary transition-colors disabled:opacity-50",children:e.jsx(se,{className:"w-5 h-5"})})]}),r==="setup"?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:[e.jsxs("h4",{className:"font-semibold text-blue-900 mb-2 flex items-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4"}),"Step 1: Scan QR Code"]}),e.jsx("p",{className:"text-sm text-blue-800",children:"Open your authenticator app (Google Authenticator, Authy, 1Password, etc.) and scan the QR code below."})]}),e.jsx("div",{className:"flex justify-center p-6 bg-white border-2 border-primary-10 rounded-xl",children:e.jsx("img",{src:n.qrCode,alt:"TOTP QR Code",className:"w-64 h-64"})}),e.jsxs("div",{className:"bg-gray-50 border border-primary-10 rounded-xl p-4",children:[e.jsxs("h4",{className:"font-semibold text-primary mb-3 flex items-center gap-2",children:[e.jsx(we,{className:"w-4 h-4"}),"Can't scan? Enter manually"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-primary-50 mb-2",children:"Secret Key:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"flex-1 bg-white border border-primary-10 rounded-lg p-3 font-mono text-sm break-all",children:n.secret}),e.jsx(p,{type:"button",variant:j?"primary":"outline",size:"sm",onClick:K,children:j?e.jsx(te,{}):e.jsx(ae,{})})]})]})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-4",children:[e.jsx("h4",{className:"font-semibold text-yellow-900 mb-2",children:"Save Your Backup Codes"}),e.jsx("p",{className:"text-sm text-yellow-800 mb-3",children:"Store these codes in a safe place. You can use them to access your account if you lose your authenticator device."}),e.jsx("div",{className:"bg-white border border-yellow-200 rounded-lg p-3 mb-3",children:e.jsx("div",{className:"grid grid-cols-2 gap-2 font-mono text-sm",children:n.backupCodes.map((o,f)=>e.jsx("div",{className:"text-primary-75",children:o},f))})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{type:"button",variant:"outline",size:"sm",onClick:N,className:"flex-1",children:h?e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"mr-2"}),"Copied"]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"mr-2"}),"Copy Codes"]})}),e.jsxs(p,{type:"button",variant:"outline",size:"sm",onClick:V,className:"flex-1",children:[e.jsx(Ne,{className:"mr-2"}),"Download"]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-primary-10",children:[e.jsx(p,{type:"button",variant:"outline",onClick:s,disabled:u,children:"Cancel"}),e.jsx(p,{type:"button",variant:"primary",onClick:B,disabled:u,children:"Next: Verify Setup"})]})]}):e.jsxs("form",{onSubmit:R,className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"Step 2: Verify Your Setup"}),e.jsx("p",{className:"text-sm text-blue-800",children:"Enter the 6-digit code from your authenticator app to complete the setup."})]}),e.jsx(L,{id:"verification-code",label:"Verification Code",type:"text",placeholder:"Enter 6-digit code",value:c,onChange:o=>{const f=o.target.value.replace(/\D/g,"");f.length<=6&&g(f)},required:!0,maxLength:6}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-primary-10",children:[e.jsx(p,{type:"button",variant:"outline",onClick:()=>m("setup"),disabled:b,children:"Back"}),e.jsx(p,{type:"submit",variant:"primary",loading:b,disabled:b||c.length!==6,children:"Verify & Enable"})]})]})]})})},ts=()=>{const{mfaEnabled:t,setMfaEnabled:s}=de(),{mutate:l,isPending:r}=ce(),{mutate:m,isPending:n}=ue(),{data:d,isLoading:c}=me(),{data:g,isLoading:j}=xe(),{mutate:w,isPending:h}=be(),[S,x]=i.useState(!1),[u,T]=i.useState(!1),[b,C]=i.useState(null),[K,N]=i.useState(!1),[V,R]=i.useState(!1),[B,o]=i.useState(!1),{data:f,isLoading:A}=qe(),k=g?.data?.totpEnabled??!1,P=f?.data?.stats;i.useEffect(()=>{if(!c&&d?.data?.mfaEnabled!==void 0){const Q=!!d.data.mfaEnabled;Q!==t&&s(Q)}},[c,d,t,s]);const $=c?"Checking...":t?"Enabled":"Disabled",Y=c?"text-primary-50":t?"text-green-600":"text-red-500",W=j?"Checking...":k?"Enabled":"Disabled",G=j?"text-primary-50":k?"text-green-600":"text-red-500",J=()=>{t?(C("disable"),x(!0)):(C("enable"),x(!0))},H=()=>{b==="enable"?l():b==="disable"&&m(),x(!1),C(null)},z=()=>{x(!1),C(null)},a=()=>{R(!0)},y=()=>{T(!0)},X=()=>{w(),T(!1)},E=()=>{T(!1)},F=t?n?"Disabling...":"Disable 2FA":r?"Enabling...":"Enable 2FA";return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-primary mb-4",children:"Security Settings"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 border border-primary-10 rounded-xl",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-primary",children:"Change Password"}),e.jsx("div",{className:"text-sm text-primary-50",children:"Update your password to keep your account secure"})]}),e.jsx(p,{size:"sm",onClick:()=>N(!0),children:"Change Password"})]})}),e.jsx("div",{className:"p-4 border border-primary-10 rounded-xl",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-primary",children:"Two-Factor Authentication (Email)"}),e.jsx("div",{className:"text-sm text-primary-50",children:"Receive verification codes via email"}),e.jsxs("div",{className:"text-xs text-primary-40 mt-2",children:["Status:"," ",e.jsx("span",{className:Y,children:$})]})]}),e.jsx(p,{size:"sm",onClick:J,loading:r||n,disabled:r||n||c,children:F})]})}),e.jsx("div",{className:"p-4 border border-primary-10 rounded-xl",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-primary",children:"Authenticator App"}),e.jsx("div",{className:"text-sm text-primary-50",children:"Use an authenticator app like Google/Microsoft Authenticator"}),e.jsxs("div",{className:"text-xs text-primary-40 mt-2",children:["Status:"," ",e.jsx("span",{className:G,children:W})]})]}),e.jsx(p,{size:"sm",onClick:k?y:a,loading:h,disabled:h||j,children:k?h?"Disabling...":"Disable TOTP":"Enable TOTP"})]})}),e.jsx("div",{className:"p-4 border border-primary-10 rounded-xl",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-primary",children:"Passkeys"}),e.jsx("div",{className:"text-sm text-primary-50",children:"Use biometrics or security keys for passwordless sign-in"}),e.jsx("div",{className:"text-xs text-primary-40 mt-2",children:A?"Loading...":P?.total?e.jsxs(e.Fragment,{children:[P.active," active of"," ",P.total," total passkey",P.total!==1?"s":""," • ",P.platform," device",P.platform!==1?"s":"",", ",P.roaming," security key",P.roaming!==1?"s":""]}):"No passkeys configured"})]}),e.jsx(p,{size:"sm",onClick:()=>o(!0),disabled:A,children:"Manage Passkeys"})]})})]}),e.jsx(Be,{isOpen:K,onClose:()=>N(!1)}),e.jsx(Ie,{isOpen:V,onClose:()=>R(!1)}),e.jsx(Qe,{isOpen:B,onClose:()=>o(!1)}),e.jsx(U,{isOpen:S,onClose:z,onConfirm:H,title:b==="enable"?"Enable Two-Factor Authentication":"Disable Two-Factor Authentication",message:b==="enable"?"Are you sure you want to enable two-factor authentication? You will need to verify your identity with a code sent to your email when logging in.":"Are you sure you want to disable two-factor authentication? This will reduce the security of your account.",confirmText:b==="enable"?"Enable 2FA":"Disable 2FA",cancelText:"Cancel",confirmVariant:b==="disable"?"danger":"primary",loading:r||n}),e.jsx(U,{isOpen:u,onClose:E,onConfirm:X,title:"Disable Authenticator App",message:"Are you sure you want to disable TOTP authenticator? This will reduce the security of your account.",confirmText:"Disable TOTP",cancelText:"Cancel",confirmVariant:"danger",loading:h})]})};export{ts as default};
