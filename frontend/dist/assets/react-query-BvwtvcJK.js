import{a as u,j as v}from"./react-core-0npe00lJ.js";import{s as C,n as E,a as f,i as b,Q as x,M}from"./vendor-CGKUqG9W.js";var p=u.createContext(void 0),g=e=>{const s=u.useContext(p);if(!s)throw new Error("No QueryClient set, use QueryClientProvider to set one");return s},U=({client:e,children:s})=>(u.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),v.jsx(p.Provider,{value:e,children:s})),R=u.createContext(!1),_=()=>u.useContext(R);R.Provider;function Q(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var d=u.createContext(Q()),w=()=>u.useContext(d),I=(e,s)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(s.isReset()||(e.retryOnMount=!1))},O=e=>{u.useEffect(()=>{e.clearReset()},[e])},T=({result:e,errorResetBoundary:s,throwOnError:o,query:t,suspense:n})=>e.isError&&!s.isReset()&&!e.isFetching&&t&&(n&&e.data===void 0||C(o,[e.error,t])),P=e=>{if(e.suspense){const o=n=>n==="static"?n:Math.max(n??1e3,1e3),t=e.staleTime;e.staleTime=typeof t=="function"?(...n)=>o(t(...n)):o(t),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},N=(e,s)=>e.isLoading&&e.isFetching&&!s,q=(e,s)=>e?.suspense&&s.isPending,m=(e,s,o)=>s.fetchOptimistic(e).catch(()=>{o.clearReset()});function B(e,s,o){const t=_(),n=w(),i=g(),r=i.defaultQueryOptions(e);i.getDefaultOptions().queries?._experimental_beforeQuery?.(r),r._optimisticResults=t?"isRestoring":"optimistic",P(r),I(r,n),O(n);const l=!i.getQueryCache().get(r.queryHash),[a]=u.useState(()=>new s(i,r)),c=a.getOptimisticResult(r),y=!t&&e.subscribed!==!1;if(u.useSyncExternalStore(u.useCallback(h=>{const S=y?a.subscribe(E.batchCalls(h)):f;return a.updateResult(),S},[a,y]),()=>a.getCurrentResult(),()=>a.getCurrentResult()),u.useEffect(()=>{a.setOptions(r)},[r,a]),q(r,c))throw m(r,a,n);if(T({result:c,errorResetBoundary:n,throwOnError:r.throwOnError,query:i.getQueryCache().get(r.queryHash),suspense:r.suspense}))throw c.error;return i.getDefaultOptions().queries?._experimental_afterQuery?.(r,c),r.experimental_prefetchInRender&&!b&&N(c,t)&&(l?m(r,a,n):i.getQueryCache().get(r.queryHash)?.promise)?.catch(f).finally(()=>{a.updateResult()}),r.notifyOnChangeProps?c:a.trackResult(c)}function j(e,s){return B(e,x)}function F(e,s){const o=g(),[t]=u.useState(()=>new M(o,e));u.useEffect(()=>{t.setOptions(e)},[t,e]);const n=u.useSyncExternalStore(u.useCallback(r=>t.subscribe(E.batchCalls(r)),[t]),()=>t.getCurrentResult(),()=>t.getCurrentResult()),i=u.useCallback((r,l)=>{t.mutate(r,l).catch(f)},[t]);if(n.error&&C(t.options.throwOnError,[n.error]))throw n.error;return{...n,mutate:i,mutateAsync:n.mutate}}export{U as Q,g as a,j as b,F as u};
