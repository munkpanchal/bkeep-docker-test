import{a as f,j as t}from"./react-core-0npe00lJ.js";import{a as B,u as E}from"./react-router-lgh_Y1WM.js";import{j as O,k as P,m as D,B as h,e as L,f as M}from"./index-HjQGXCX9.js";import{I as F}from"./InputFields-CMQHEwPH.js";import{u as U}from"./mfaApi-C0--BS-Z.js";import"./react-dom-CdyVvfHO.js";import"./vendor-CGKUqG9W.js";import"./react-query-BvwtvcJK.js";import"./ui-libs-CuSWTeap.js";import"./react-icons-B--SyvS1.js";import"./zustand-Ccm-5Iud.js";import"./axios-B9ygI19o.js";const _=()=>{const g=B(),d=E(),m=g.state,[i,u]=f.useState(""),[a,x]=f.useState(!1),n=m?.email,o=m?.mfaType||"email",{setAuth:y}=O(),{setTenants:b}=P(),{mutateAsync:T,isPending:v}=D(),{mutateAsync:j,isPending:k}=U(),c=v||k,w=r=>{if(!r)return[];const s=new Map;return r.forEach(e=>{e&&e.id&&s.set(e.id,e)}),Array.from(s.values())},A=async r=>{if(r.preventDefault(),!n){d("/login");return}try{if(o==="totp"){const s=await j({email:n,code:i,isBackupCode:a}),e=s?.data;if(e?.user&&e?.accessToken&&e?.refreshToken){const p=(e.user.tenants||[]).map(l=>({...l,isActive:l.isActive??!0,createdAt:l.createdAt||new Date().toISOString(),updatedAt:l.updatedAt||new Date().toISOString()})),V={...e.user,roles:e.user.role?[e.user.role]:[],permissions:e.user.permissions||[],tenants:p,selectedTenantId:e.user.selectedTenantId||""};y(V,e.accessToken,e.refreshToken);const I=w(p);b(I,{selectTenantId:e.user.selectedTenantId}),L(e.user.email),M(s?.message||"Successfully verified. Welcome back!"),d("/dashboard")}}else await T({email:n,code:i})}catch(s){console.error("Verification failed:",s)}},N=()=>{d("/login")},C=()=>{switch(o){case"totp":return"Enter Authenticator Code";case"email":default:return"Enter Verification Code"}},S=()=>{switch(o){case"totp":return t.jsxs(t.Fragment,{children:["Open your authenticator app and enter the 6-digit code for"," ",t.jsx("span",{className:"font-semibold text-primary",children:n||"your account"}),"."]});case"email":default:return t.jsxs(t.Fragment,{children:["We've sent an email verification code to"," ",t.jsx("span",{className:"font-semibold text-primary",children:n||"your email"}),". Please enter it below to continue."]})}};return t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-lightBg px-4",children:t.jsxs("div",{className:"w-full max-w-md bg-white rounded-2xl shadow-xl p-6 lg:p-8 border border-primary-10",children:[t.jsx("h1",{className:"text-2xl font-bold text-primary mb-2",children:C()}),t.jsx("p",{className:"text-sm text-primary-50 mb-6",children:S()}),t.jsxs("form",{onSubmit:A,className:"space-y-6",children:[t.jsx(F,{id:"otp-code",label:o==="totp"?a?"Backup Code":"Authenticator Code":"Verification Code",value:i,onChange:r=>{const s=a?r.target.value.replace(/[^a-zA-Z0-9]/g,""):r.target.value.replace(/\D/g,"");(!a&&s.length<=6||a&&s.length<=16)&&u(s)},placeholder:a?"Enter backup code":"Enter the 6-digit code",maxLength:a?16:6,required:!0}),o==="totp"&&t.jsx("div",{className:"flex items-center justify-center",children:t.jsx("button",{type:"button",onClick:()=>{x(!a),u("")},className:"text-sm text-primary hover:underline",children:a?"Use authenticator code instead":"Use backup code instead"})}),t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsx(h,{type:"submit",variant:"primary",className:"w-full",loading:c,disabled:c||(a?i.length===0:i.length!==6),children:c?"Verifying...":"Verify & Continue"}),t.jsx(h,{type:"button",variant:"outline",size:"sm",className:"w-full",onClick:N,disabled:c,children:"Back to Login"})]})]})]})})};export{_ as default};
